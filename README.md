# PBD Cloth Simulation with WebGPU

Этот репозиторий содержит пример симуляции ткани на основе метода Position‑Based Dynamics (PBD) с визуализацией через WebGPU. Проект организован по принципам **SOLID**, **DRY**, **KISS** и использует объектно‑ориентированный подход.

## Структура проекта

```
pbd-cloth/
├─ public/            — статические файлы (HTML/CSS)
├─ src/               — исходный код TypeScript
│  ├─ app.ts          — точка входа приложения
│  ├─ ui/             — обработка пользовательского интерфейса
│  ├─ render/         — визуализация через WebGPU
│  ├─ sim/            — симулятор ткани
│  │  ├─ structures/  — модели частиц и ограничений
│  │  ├─ Solver.ts    — PBD‑солвер
│  │  └─ ClothSimulator.ts — управление сеткой и логикой
│  ├─ geom/           — генераторы геометрии
│  ├─ utils/          — вспомогательные классы
│  └─ shaders/        — код WGSL для вершинного и фрагментного шейдера
├─ package.json       — зависимости и скрипты
├─ tsconfig.json      — настройки компилятора TypeScript
└─ README.md
```

## Запуск

1. Установите зависимости:
   ```bash
   npm install
   ```
2. Запустите статический сервер (в проекте используется http-server):
   ```bash
   npm run serve
   ```
   Это поднимет сервер на `http://localhost:5173/`.
3. Откройте `http://localhost:5173/public/` в браузере, поддерживающем WebGPU (Chrome, Edge, Firefox Nightly).

## Управление

- **Включить гравитацию** — чекбокс включает/выключает силу тяжести.
- **Итерации проекции** — регулирует количество итераций солвера при удовлетворении ограничений.
- **Размер сетки** — число узлов по стороне. После изменения нажмите **Сброс** для перестройки сетки.

## Принцип работы

Симуляция следует алгоритму PBD: частицы (вершины сетки) перемещаются инерционно, затем многократно проецируются на ограничения (дистанционные связи), пока отклонение от исходной длины связи не станет минимальным. PBD работает напрямую с позициями, что позволяет избегать численной нестабильности, характерной для явных методов интегрирования. Метод быстро и просто настраивается, а точность контролируется числом итераций【191522903007478†L86-L98】. Отрицательная сторона — жёсткость модели зависит от величины временного шага и числа итераций【191522903007478†L86-L99】.

WebGPU предоставляет интерфейс для работы с графическим процессором, позволяя выполнять рендеринг и вычисления параллельно【934181653258753†L42-L47】. Шейдеры описаны на языке WGSL — статически типизированном языке, поддерживающем векторы, матрицы, текстуры и самплеры【826023106141124†L670-L681】. В текущей реализации симуляция выполняется на CPU (для простоты), но архитектура позволяет заменить `PBDSolver` на GPU‑решатель.

## Источники и рекомендации

* Статья Carmen Cincotti «Position Based Dynamics | PBD» даёт введение в метод PBD и описывает его преимущества и недостатки【191522903007478†L86-L98】.
* Спецификация WebGPU описывает, что API позволяет выполнять операции рендеринга и вычислений на GPU【934181653258753†L42-L47】.
* Спецификация WGSL описывает язык шейдеров и подчёркивает, что язык статически типизирован, а типы могут быть скалярными, векторными и матричными【826023106141124†L670-L681】.

Если требуется улучшить реализм симуляции, вы можете внедрить Extended PBD (XPBD) с комплаенс‑параметром или перенести проекцию ограничений на GPU с помощью вычислительных шейдеров.